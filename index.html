<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub LIFF Demo</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "Muli", sans-serif; padding: 20px; text-align: center; }
        button { padding: 10px 20px; font-size: 16px; margin-top: 20px; cursor: pointer; }
        #log { color: red; font-size: 12px; margin-top: 20px; text-align: left; background: #f0f0f0; padding: 10px; display: none;}
    </style>
</head>
<body>
    <h2>LIFF on GitHub Pages</h2>
    <p id="status">åˆå§‹åŒ–ä¸­...</p>
    <div id="profile" style="display:none;">
        <p>ä½ å¥½ï¼Œ<b id="displayName"></b></p>
        <p>User ID: <span id="userId"></span></p>
        <button onclick="sendData()">å‚³é€è³‡æ–™åˆ° Google Sheet</button>
    </div>
    <div id="log"></div>

    <script>
        // ğŸ”´ è¨­å®šå€
        const MY_LIFF_ID = "2009018559-AeGOURPY"; // è«‹æ›æˆçœŸå¯¦ ID
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbzq8QoWuBjWrjvMv6FvsttGmEdHIF9DrsmMQdw9XTfvlT2ywYJUZRnflROibd0kEOQ6/exec"; // è«‹æ›æˆå‰›å‰›è¤‡è£½çš„ /exec ç¶²å€

        // é¡¯ç¤º Log ç”¨
        function showLog(msg) {
            const log = document.getElementById('log');
            log.style.display = 'block';
            log.innerHTML += "ğŸ“ " + msg + "<br>";
        }

        async function main() {
            try {
                await liff.init({ liffId: MY_LIFF_ID });
                
                if (!liff.isLoggedIn()) {
                    liff.login(); // GitHub æ˜¯ä¸€èˆ¬ç¶²é ï¼Œé€™è£¡å¯ä»¥ç›´æ¥å‘¼å« loginï¼Œä¸æœƒå ±éŒ¯ï¼
                    return;
                }

                const profile = await liff.getProfile();
                document.getElementById('status').innerText = "ç™»å…¥æˆåŠŸï¼";
                document.getElementById('profile').style.display = "block";
                document.getElementById('displayName').innerText = profile.displayName;
                document.getElementById('userId').innerText = profile.userId;

                // å­˜å…¨åŸŸè®Šæ•¸æ–¹ä¾¿å‚³é€
                window.userProfile = profile;

            } catch (err) {
                showLog("åˆå§‹åŒ–éŒ¯èª¤: " + err.message);
            }
        }

        function sendData() {
            document.getElementById('status').innerText = "å‚³é€ä¸­...";
            
            // é€é fetch API å‚³é€ POST è«‹æ±‚çµ¦ GAS
            fetch(GAS_API_URL, {
                method: "POST",
                // é€™è£¡ç”¨ text/plain æ˜¯ä¸€å€‹é¿å… CORS éŒ¯èª¤çš„å°æŠ€å·§ï¼ŒGAS ä¸€æ¨£è®€å¾—åˆ°
                headers: { "Content-Type": "text/plain" },
                body: JSON.stringify({
                    userId: window.userProfile.userId,
                    displayName: window.userProfile.displayName
                })
            })
            .then(response => response.json())
            .then(data => {
                alert("æˆåŠŸï¼å¾Œç«¯å›æ‡‰ï¼š" + data.message);
                document.getElementById('status').innerText = "å‚³é€å®Œæˆ";
            })
            .catch(error => {
                showLog("å‚³é€å¤±æ•—: " + error);
                document.getElementById('status').innerText = "å‚³é€å¤±æ•—";
            });
        }

        main();
    </script>
</body>
</html>
